<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">

  {# -------------------- MkDocs pages (Markdown) -------------------- #}
  {%- for file in pages -%}
    {% if not file.page.is_link and (file.page.abs_url or file.page.canonical_url) %}
      <url>
        <loc>
          {% if file.page.canonical_url %}
            {{ file.page.canonical_url | e }}
          {% else %}
            {{ file.page.abs_url | e }}
          {% endif %}
        </loc>

        {% set lastmod = file.page.meta.document_dates_updated %}
        {% if lastmod %}
          <lastmod>{{ (lastmod + "+00:00") | replace(" ", "T") }}</lastmod>
        {% endif %}
      </url>
    {% endif %}
  {%- endfor -%}

  {# -------------------- Static HTML files -------------------- #}
  {%- set static_map = config.extra.static_lastmod or {} -%}
  {%- for f in files -%}
    {% set lastmod = static_map.get(f.url) %}
    {% if lastmod %}
      <url>
        <loc>{{ (config.site_url ~ f.url) | e }}</loc>
        <lastmod>{{ lastmod }}</lastmod>
      </url>
    {% endif %}
  {%- endfor -%}

</urlset>
