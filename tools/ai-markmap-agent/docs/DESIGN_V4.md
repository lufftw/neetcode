# AI Markmap Agent - Design V4

## Overview

æœ¬æ–‡ä»¶æè¿° AI Markmap Agent çš„ç¬¬å››ç‰ˆè¨­è¨ˆï¼Œæ ¸å¿ƒç†å¿µæ˜¯ï¼š

**ã€Œå¾ç²¾é€²å‡ºç™¼ï¼Œè€Œéå¾é›¶å‰µé€ ã€**

| V3 åšæ³• | V4 åšæ³• |
|---------|---------|
| å¾è³‡æ–™å‰µé€  Structure Spec | å¾**å·²æœ‰çš„é«˜å“è³ª Markmap** ç²¾é€² |
| ä¸­é–“æ ¼å¼æ˜¯ YAML | **ç›´æ¥æ“ä½œ Markmap**ï¼Œå»ºè­°ç”¨è‡ªç„¶èªè¨€ |
| Planner ç”¢ç”Ÿçµæ§‹ | âŒ ä¸éœ€è¦ Planner |
| æ³›åŒ–çš„ Strategist è§’è‰² | **é ˜åŸŸå°ˆç²¾**çš„å°ˆå®¶è§’è‰² |
| è¨è«–ã€Œçµæ§‹æ‡‰è©²é•·ä»€éº¼æ¨£ã€ | è¨è«–ã€Œé€™å€‹çµæ§‹å“ªè£¡å¯ä»¥æ›´å¥½ã€ |

---

## Core Philosophy

### ç‚ºä»€éº¼ V4 æ›´å¥½ï¼Ÿ

1. **å‰µä½œ vs ç²¾é€²**
   - å‰µä½œéœ€è¦ç™¼æ•£æ€ç¶­ â†’ å–®ä¸€å¼·æ¨¡å‹æ›´å¥½ï¼ˆå·²ç”± `mindmap_prompt.md` å®Œæˆï¼‰
   - ç²¾é€²éœ€è¦æ”¶æ–‚æ€ç¶­ â†’ å¤šå°ˆå®¶å¯©æŸ¥æœ‰åƒ¹å€¼

2. **æœ‰éŒ¨é»çš„è¨è«–**
   - V3ï¼šå°ˆå®¶è¨è«–ã€Œçµæ§‹æ‡‰è©²é•·ä»€éº¼æ¨£ã€â†’ æ„è¦‹åˆ†æ­§å¤§ï¼Œå¦¥å”å‡ºä¸­åº¸çµæœ
   - V4ï¼šå°ˆå®¶è¨è«–ã€Œé€™å€‹çµæ§‹å“ªè£¡å¯ä»¥æ›´å¥½ã€â†’ æœ‰å…±åŒçš„è¨è«–å°è±¡ï¼Œèšç„¦å…·é«”æ”¹é€²

3. **ä¿¡ä»» AI çš„èªè¨€èƒ½åŠ›**
   - V3ï¼šå¼·åˆ¶ YAML æ ¼å¼çš„å»ºè­° â†’ é™åˆ¶è¡¨é”
   - V4ï¼šè‡ªç„¶èªè¨€çš„å»ºè­° â†’ AI æœ€æ“…é•·çš„é ˜åŸŸ

---

## Architecture V4

### API å‘¼å«æ•ˆç‡

æ¡ç”¨ã€Œ2 è¼ªå…¨é¢è¨è«–ã€æ¨¡å¼ï¼Œæœ€å¤§åŒ–æ•ˆç‡ï¼š

```
è¨­ N = å°ˆå®¶æ•¸é‡ï¼ˆåˆå§‹å¯¦ä½œ N=3ï¼‰

Round 1: N parallel callsï¼ˆç¨ç«‹å¯©æŸ¥ï¼‰
Round 2: N parallel callsï¼ˆå…¨é¢è¨è«–ï¼‰
Writer:  1 call
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total:   2N + 1 calls
Sequential batches: 3ï¼ˆå›ºå®šï¼Œä¸éš¨ N å¢åŠ ï¼‰
```

| N å°ˆå®¶ | API å‘¼å« | Sequential Batches |
|--------|---------|-------------------|
| **3** | **7** | **3** â† åˆå§‹å¯¦ä½œ |
| 5 | 11 | 3 |
| 7 | 15 | 3 |

### å®Œæ•´æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AI Markmap Agent V4                                  â”‚
â”‚                   ã€Œç²¾é€²æ¨¡å¼ã€â€” 2 è¼ªå…¨é¢è¨è«–æ¶æ§‹                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  Phase 0: Input Loading                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Baseline Markmap            â”‚     â”‚ Reference Data                  â”‚   â”‚
â”‚  â”‚ (config: input.baseline)    â”‚     â”‚ â€¢ Ontology                      â”‚   â”‚
â”‚  â”‚                             â”‚     â”‚ â€¢ Problems                      â”‚   â”‚
â”‚  â”‚ neetcode_ontology_ai_en.md  â”‚     â”‚ â€¢ Patterns                      â”‚   â”‚
â”‚  â”‚ (generated by single prompt)â”‚     â”‚                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                                                             â”‚
â”‚              â–¼                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  Phase 1: Independent Review (N=3 parallel calls)                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ ğŸ—ï¸ Architect â”‚    â”‚ ğŸ“š Professor â”‚    â”‚ âš™ï¸ Engineer  â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚          â”‚                   â”‚                   â”‚                         â”‚
â”‚          â–¼                   â–¼                   â–¼                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚ å»ºè­° A1-A5 â”‚      â”‚ å»ºè­° P1-P5 â”‚      â”‚ å»ºè­° E1-E5 â”‚                   â”‚
â”‚   â”‚ (è‡ªç„¶èªè¨€)  â”‚      â”‚ (è‡ªç„¶èªè¨€)  â”‚      â”‚ (è‡ªç„¶èªè¨€)  â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚          â”‚                   â”‚                   â”‚                         â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                              â”‚                                             â”‚
â”‚                              â–¼                                             â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                 â”‚  All suggestions       â”‚                                 â”‚
â”‚                 â”‚  collected (15 items)  â”‚                                 â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                              â”‚                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  Phase 2: Full Discussion (N=3 parallel calls)                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                              â”‚                                             â”‚
â”‚                              â–¼                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  æ¯ä½å°ˆå®¶æ”¶åˆ°ï¼š                                                      â”‚  â”‚
â”‚   â”‚  â€¢ Baseline Markmap                                                  â”‚  â”‚
â”‚   â”‚  â€¢ è‡ªå·±çš„å»ºè­°                                                        â”‚  â”‚
â”‚   â”‚  â€¢ å…¶ä»–å…©äººçš„æ‰€æœ‰å»ºè­°                                                â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  ä»»å‹™ï¼š                                                              â”‚  â”‚
â”‚   â”‚  1. å°å…¶ä»–äººçš„æ¯æ¢å»ºè­°è¡¨æ…‹ï¼ˆâœ… åŒæ„ / âš ï¸ ä¿®æ”¹ / âŒ åå°ï¼‰           â”‚  â”‚
â”‚   â”‚  2. èªªæ˜ç†ç”±ï¼ˆè‡ªç„¶èªè¨€ï¼‰                                             â”‚  â”‚
â”‚   â”‚  3. è¼¸å‡ºã€Œæˆ‘èªç‚ºæ‡‰è©²æ¡ç´çš„å®Œæ•´æ”¹é€²æ¸…å–®ã€                             â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ ğŸ—ï¸ Architect â”‚    â”‚ ğŸ“š Professor â”‚    â”‚ âš™ï¸ Engineer  â”‚                 â”‚
â”‚   â”‚              â”‚    â”‚              â”‚    â”‚              â”‚                 â”‚
â”‚   â”‚ å° P1: âœ…    â”‚    â”‚ å° A1: âœ…    â”‚    â”‚ å° A1: âœ…    â”‚                 â”‚
â”‚   â”‚ å° P2: âš ï¸    â”‚    â”‚ å° A2: âš ï¸    â”‚    â”‚ å° A2: âœ…    â”‚                 â”‚
â”‚   â”‚ å° E1: âœ…    â”‚    â”‚ å° E1: âœ…    â”‚    â”‚ å° P1: âœ…    â”‚                 â”‚
â”‚   â”‚ ...          â”‚    â”‚ ...          â”‚    â”‚ ...          â”‚                 â”‚
â”‚   â”‚              â”‚    â”‚              â”‚    â”‚              â”‚                 â”‚
â”‚   â”‚ æˆ‘çš„æ¡ç´æ¸…å–®ï¼šâ”‚    â”‚ æˆ‘çš„æ¡ç´æ¸…å–®ï¼šâ”‚    â”‚ æˆ‘çš„æ¡ç´æ¸…å–®ï¼šâ”‚                 â”‚
â”‚   â”‚ [A1,A3,P1,  â”‚    â”‚ [A1,P1,P3,  â”‚    â”‚ [A1,A2,P1,  â”‚                 â”‚
â”‚   â”‚  E1,E2]     â”‚    â”‚  E1,E3]     â”‚    â”‚  E1,E2]     â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚          â”‚                   â”‚                   â”‚                         â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                              â”‚                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  Consensus Calculation (Code, not AI)                                       â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                              â”‚                                             â”‚
â”‚                              â–¼                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  å¤šæ•¸æ±ºï¼ˆ2/3 åŒæ„å³æ¡ç´ï¼‰                                            â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  A1: 3/3 âœ… â†’ æ¡ç´                                                   â”‚  â”‚
â”‚   â”‚  A2: 2/3 âœ… â†’ æ¡ç´                                                   â”‚  â”‚
â”‚   â”‚  A3: 1/3 âœ… â†’ ä¸æ¡ç´                                                 â”‚  â”‚
â”‚   â”‚  P1: 3/3 âœ… â†’ æ¡ç´                                                   â”‚  â”‚
â”‚   â”‚  P3: 1/3 âœ… â†’ ä¸æ¡ç´                                                 â”‚  â”‚
â”‚   â”‚  E1: 3/3 âœ… â†’ æ¡ç´                                                   â”‚  â”‚
â”‚   â”‚  E2: 2/3 âœ… â†’ æ¡ç´                                                   â”‚  â”‚
â”‚   â”‚  E3: 1/3 âœ… â†’ ä¸æ¡ç´                                                 â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  âœ… æ¡ç´æ¸…å–®: [A1, A2, P1, E1, E2]                                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  Phase 3: Writing (1 call)                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                              â”‚                                             â”‚
â”‚                              â–¼                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                           Writer                                     â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚   è¼¸å…¥:                                                              â”‚  â”‚
â”‚   â”‚   â€¢ Baseline Markmap                                                 â”‚  â”‚
â”‚   â”‚   â€¢ æ¡ç´çš„æ”¹é€²æ¸…å–® [A1, A2, P1, E1, E2]                              â”‚  â”‚
â”‚   â”‚   â€¢ å®Œæ•´çš„è¨è«–ç´€éŒ„ï¼ˆä¾›åƒè€ƒï¼‰                                          â”‚  â”‚
â”‚   â”‚   â€¢ Reference Dataï¼ˆé©—è­‰ç”¨ï¼‰                                         â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚   ä»»å‹™:                                                              â”‚  â”‚
â”‚   â”‚   æ ¹æ“šæ¡ç´æ¸…å–®ï¼Œå° Baseline é€²è¡Œç²¾ç¢ºä¿®æ”¹ã€‚                            â”‚  â”‚
â”‚   â”‚   ä¿ç•™åŸæœ‰çš„å„ªç§€çµæ§‹ï¼Œåªæ‡‰ç”¨æ¸…å–®ä¸­çš„æ”¹å‹•ã€‚                            â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚   è¼¸å‡º:                                                              â”‚  â”‚
â”‚   â”‚   â€¢ neetcode_ontology_agent_evolved_en.md                                  â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  Phase 4: Post-Processing (Code)                                            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                              â”‚                                             â”‚
â”‚                              â–¼                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   â€¢ Link Validation (Code) - æª¢æŸ¥é€£çµæ˜¯å¦æ­£ç¢º                        â”‚  â”‚
â”‚   â”‚   â€¢ Format Fixing (Code) - LC â†’ LeetCode æ›¿æ›ç­‰                      â”‚  â”‚
â”‚   â”‚   â€¢ Translation (AI) - en â†’ zh-TWï¼ˆå¦‚éœ€è¦ï¼‰                          â”‚  â”‚
â”‚   â”‚   â€¢ HTML Generation (Code) - .md â†’ .html                             â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Expert Roles (V4)

### è¨­è¨ˆåŸå‰‡

V4 çš„å°ˆå®¶è§’è‰²æ˜¯**é ˜åŸŸå°ˆç²¾**çš„ï¼Œè€Œé V3 çš„æ³›åŒ–è§’è‰²ã€‚é€™äº›è§’è‰²ç›´æ¥å°æ‡‰æ¼”ç®—æ³•å­¸ç¿’é ˜åŸŸçš„æ ¸å¿ƒé—œæ³¨é»ã€‚

### ä¸‰å¤§å°ˆå®¶

#### ğŸ—ï¸ Top Software Architect

```
è§’è‰²å®šä½ï¼š
  é ‚ç´šçš„ç¨‹å¼æ¶æ§‹å¸«ï¼Œå°ˆæ³¨æ–¼ç³»çµ±è¨­è¨ˆå±¤é¢çš„æ¼”ç®—æ³•æ‡‰ç”¨

å¯©æŸ¥è¦–è§’ï¼š
  â€¢ API Kernel çš„æŠ½è±¡æ˜¯å¦ä¹¾æ·¨ã€å¯çµ„åˆ
  â€¢ Pattern ä¹‹é–“çš„æ¨¡çµ„åŒ–é—œä¿‚
  â€¢ ç¨‹å¼ç¢¼æ¨¡æ¿çš„å¯é‡ç”¨æ€§
  â€¢ æ¼”ç®—æ³•å¦‚ä½•æ˜ å°„åˆ°ç³»çµ±è¨­è¨ˆ

å…¸å‹å»ºè­°ï¼ˆè‡ªç„¶èªè¨€ï¼‰ï¼š
  ã€ŒSubstringSlidingWindow å’Œ TwoPointersTraversal çš„é‚Šç•Œä¸å¤ æ¸…æ™°ã€‚
   å»ºè­°åœ¨é–‹é ­åŠ ä¸€å€‹æ¯”è¼ƒè¡¨ï¼Œèªªæ˜ä½•æ™‚ç”¨å“ªå€‹ Kernelã€‚ã€

  ã€Œé€™å€‹ç¨‹å¼ç¢¼æ¨¡æ¿å¤ªç‰¹å®šäº†ï¼Œå»ºè­°æŠ½è±¡æˆæ›´é€šç”¨çš„å½¢å¼ï¼Œ
   è®“è®€è€…èƒ½å¥—ç”¨åˆ°å…¶ä»–å•é¡Œã€‚ã€
```

#### ğŸ“š Distinguished Algorithm Professor

```
è§’è‰²å®šä½ï¼š
  å‰å¤§çš„è³‡æ·±æ¼”ç®—æ³•æ•™æˆï¼Œå°ˆæ³¨æ–¼ç†è«–æ­£ç¢ºæ€§èˆ‡æ•™å­¸æ³•

å¯©æŸ¥è¦–è§’ï¼š
  â€¢ æ¦‚å¿µè§£é‡‹æ˜¯å¦æº–ç¢º
  â€¢ å­¸ç¿’é †åºæ˜¯å¦ç¬¦åˆèªçŸ¥è² æ“”
  â€¢ è¤‡é›œåº¦åˆ†ææ˜¯å¦æ­£ç¢º
  â€¢ Invariant æè¿°æ˜¯å¦ç²¾ç¢º

å…¸å‹å»ºè­°ï¼ˆè‡ªç„¶èªè¨€ï¼‰ï¼š
  ã€ŒLeetCode 76 çš„ invariant æè¿°ä¸å¤ ç²¾ç¢ºã€‚
   ã€covers all of tã€æ‡‰è©²æ”¹æˆã€window contains all required 
   characters with sufficient frequencyã€ã€‚ã€

  ã€Œå­¸ç¿’é †åºæœ‰å•é¡Œï¼š340 (K distinct) æ‡‰è©²åœ¨ 3 (unique) ä¹‹å¾Œï¼Œ
   å› ç‚º K distinct æ˜¯ unique çš„æ³›åŒ–ã€‚ã€
```

#### âš™ï¸ Senior Principal Engineer

```
è§’è‰²å®šä½ï¼š
  è³‡æ·±çš„é ‚ç´šå·¥ç¨‹å¸«ï¼ŒåŒæ™‚ä¹Ÿæ˜¯æŠ€è¡“æ¶æ§‹èˆ‡ API æä¾›è€…

å¯©æŸ¥è¦–è§’ï¼š
  â€¢ é¢è©¦é«˜é »é¡Œæ˜¯å¦çªå‡º
  â€¢ å¯¦éš›å·¥ç¨‹æ‡‰ç”¨å ´æ™¯
  â€¢ çŸ¥è­˜çš„å¯ç™¼ç¾æ€§ï¼ˆtaxonomyï¼‰
  â€¢ Trade-off èªªæ˜æ˜¯å¦æ¸…æ¥š

å…¸å‹å»ºè­°ï¼ˆè‡ªç„¶èªè¨€ï¼‰ï¼š
  ã€ŒLeetCode 3 å’Œ 76 æ˜¯ FAANG å¿…è€ƒé¡Œï¼Œæ‡‰è©²åŠ ä¸Š ğŸ”¥ æ¨™è¨˜ã€‚
   ç›®å‰æ·¹æ²’åœ¨ä¸€å †é¡Œç›®ä¸­ï¼Œä¸å¤ çªå‡ºã€‚ã€

  ã€ŒQuickselect å’Œ Heap å…©ç¨®è§£æ³•çš„ trade-off æ²’èªªæ¸…æ¥šã€‚
   Heap æ˜¯ O(n log k) ä½†æ”¯æ´ streamingï¼ŒQuickselect æ˜¯
   expected O(n) ä½†éœ€è¦å…¨éƒ¨è³‡æ–™åœ¨è¨˜æ†¶é«”ä¸­ã€‚ã€
```

---

## Natural Language First

### ç‚ºä»€éº¼ä¸ç”¨ YAML æ ¼å¼ï¼Ÿ

| YAML æ ¼å¼ | è‡ªç„¶èªè¨€ |
|-----------|----------|
| `type: "add"` | ã€Œæˆ‘å»ºè­°å¢åŠ ...ã€ |
| `location: "section.sliding_window"` | ã€Œåœ¨ Sliding Window å€å¡Šã€ |
| `content: "..."` | ã€Œ...å…·é«”å…§å®¹...ã€ |
| `rationale: "..."` | ã€Œå› ç‚º...ã€ |

**è‡ªç„¶èªè¨€çš„å„ªå‹¢ï¼š**

1. **è¡¨é”æ›´è±å¯Œ** - å¯ä»¥è§£é‡‹ç´°å¾®çš„åŸå› å’Œè€ƒé‡
2. **AI æœ€æ“…é•·** - ç†è§£å’Œç”Ÿæˆè‡ªç„¶èªè¨€æ˜¯ LLM çš„æ ¸å¿ƒèƒ½åŠ›
3. **æ˜“æ–¼è¨è«–** - å…¶ä»–å°ˆå®¶å¯ä»¥ç›´æ¥å›æ‡‰å’Œè¾¯è«–
4. **æ¸›å°‘æ ¼å¼éŒ¯èª¤** - ä¸æœƒå› ç‚º YAML èªæ³•éŒ¯èª¤è€Œå¤±æ•—

### å»ºè­°æ ¼å¼ï¼ˆé¬†æ•£çµæ§‹ï¼‰

å°ˆå®¶çš„å»ºè­°åªéœ€è¦åŒ…å«ï¼š
- **ä»€éº¼**ï¼šå…·é«”è¦æ”¹ä»€éº¼
- **åœ¨å“ª**ï¼šåœ¨ Markmap çš„å“ªå€‹ä½ç½®
- **ç‚ºä»€éº¼**ï¼šç†ç”±ï¼ˆé€™æ˜¯æœ€é‡è¦çš„ï¼Œå› ç‚ºå…¶ä»–å°ˆå®¶æœƒè©•ä¼°ï¼‰

```markdown
## æˆ‘çš„å»ºè­°

### å»ºè­° 1ï¼šå¢åŠ  invariant èªªæ˜
åœ¨ SubstringSlidingWindow å€å¡Šçš„æ¨™é¡Œä¸‹æ–¹ï¼Œå¢åŠ ä¸€å¥è©±èªªæ˜æ ¸å¿ƒä¸è®Šé‡ï¼š
ã€ŒCore invariant: window [L,R] stays valid by expand right + contract leftã€

ç†ç”±ï¼šé€™æ˜¯ç†è§£æ‰€æœ‰ Sliding Window è®Šé«”çš„åŸºç¤ã€‚æ²’æœ‰é€™å€‹æ¦‚å¿µï¼Œè®€è€…æœƒ
æŠŠæ¯å€‹å•é¡Œç•¶ä½œç¨ç«‹çš„æŠ€å·§ä¾†è¨˜æ†¶ï¼Œè€Œä¸æ˜¯ä¸€å€‹çµ±ä¸€çš„æ¡†æ¶ã€‚

### å»ºè­° 2ï¼šèª¿æ•´å•é¡Œé †åº
å°‡ LeetCode 209 ç§»å‹•åˆ° LeetCode 3 ä¹‹å¾Œã€‚

ç†ç”±ï¼š209 çš„ cost-bounded è®Šé«”æ˜¯å»ºç«‹åœ¨ 3 çš„ unique è®Šé«”åŸºç¤ä¸Šçš„ã€‚
ç›®å‰çš„é †åºé€ æˆèªçŸ¥è·³èºï¼Œè®€è€…æœƒå›°æƒ‘ç‚ºä»€éº¼ sum >= target çš„åˆ¤æ–·
å’Œ frequency åˆ¤æ–·æœ‰é¡ä¼¼çš„ expand/contract æ¨¡å¼ã€‚
```

---

## Discussion Flowï¼ˆ2 è¼ªå…¨é¢è¨è«–ï¼‰

### Round 1: Independent Reviewï¼ˆç¨ç«‹å¯©æŸ¥ï¼‰

```
ç›®æ¨™ï¼šå„å°ˆå®¶ç¨ç«‹å¯©æŸ¥ï¼Œé¿å…ç¾¤é«”æ€ç¶­
ä¸¦è¡Œï¼šYesï¼ˆN å€‹å°ˆå®¶åŒæ™‚åŸ·è¡Œï¼‰
è¼¸å…¥ï¼šBaseline Markmap + Reference Data
è¼¸å‡ºï¼šæ¯ä½å°ˆå®¶ 3-5 æ¢è‡ªç„¶èªè¨€å»ºè­°
```

**Prompt é‡é»ï¼š**
```markdown
ä½ æ˜¯ {expert_name}ã€‚è«‹å¾ä½ çš„å°ˆæ¥­è¦–è§’å¯©æŸ¥é€™å€‹ Markmapã€‚

## ä½ æ­£åœ¨å¯©æŸ¥çš„ Markmap
{baseline_markmap}

## åƒè€ƒè³‡æ–™
{ontology_summary}
{problem_data}

## ä½ çš„ä»»å‹™
æå‡º 3-5 æ¢å…·é«”çš„æ”¹é€²å»ºè­°ã€‚æ¯æ¢å»ºè­°è«‹èªªæ˜ï¼š
1. ä»€éº¼ï¼šå…·é«”è¦æ”¹ä»€éº¼
2. åœ¨å“ªï¼šåœ¨ Markmap çš„å“ªå€‹ä½ç½®
3. ç‚ºä»€éº¼ï¼šå¾ä½ çš„å°ˆæ¥­è§’åº¦ï¼Œç‚ºä»€éº¼é€™å€‹æ”¹é€²é‡è¦

ç”¨è‡ªç„¶èªè¨€è¡¨é”ï¼Œä¸éœ€è¦ç‰¹å®šæ ¼å¼ã€‚
```

### Round 2: Full Discussionï¼ˆå…¨é¢è¨è«–ï¼‰

```
ç›®æ¨™ï¼šçœ‹åˆ°æ‰€æœ‰å»ºè­°ï¼Œä¸€æ¬¡æ€§è¡¨æ…‹ä¸¦ç”¢å‡ºæœ€çµ‚æ¡ç´æ¸…å–®
ä¸¦è¡Œï¼šYesï¼ˆN å€‹å°ˆå®¶åŒæ™‚åŸ·è¡Œï¼‰
è¼¸å…¥ï¼šBaseline + è‡ªå·±çš„å»ºè­° + æ‰€æœ‰å…¶ä»–å°ˆå®¶çš„å»ºè­°
è¼¸å‡ºï¼š
  1. å°æ¯æ¢å…¶ä»–å»ºè­°çš„è¡¨æ…‹ï¼ˆâœ…/âš ï¸/âŒï¼‰
  2. è‡ªå·±çš„æœ€çµ‚æ¡ç´æ¸…å–®
```

**Prompt é‡é»ï¼š**
```markdown
ä½ æ˜¯ {expert_name}ã€‚ä½ å·²ç¶“çœ‹åˆ°æ‰€æœ‰å°ˆå®¶çš„å»ºè­°ã€‚

## ä½ çš„å»ºè­°
{own_suggestions}

## å…¶ä»–å°ˆå®¶çš„å»ºè­°

### ğŸ—ï¸ Architect çš„å»ºè­°
{architect_suggestions}

### ğŸ“š Professor çš„å»ºè­°
{professor_suggestions}

### âš™ï¸ Engineer çš„å»ºè­°
{engineer_suggestions}

## ä½ çš„ä»»å‹™

### Part 1: å°æ¯æ¢å…¶ä»–å»ºè­°è¡¨æ…‹
å°æ¯æ¢ä¸æ˜¯ä½ æå‡ºçš„å»ºè­°ï¼Œè¡¨é”ï¼š
- âœ… åŒæ„ï¼ˆèªªæ˜ç†ç”±ï¼‰
- âš ï¸ åŒæ„ä½†å»ºè­°ä¿®æ”¹ï¼ˆèªªæ˜å¦‚ä½•ä¿®æ”¹ï¼‰
- âŒ åå°ï¼ˆèªªæ˜ç†ç”±ï¼‰

### Part 2: ä½ çš„æœ€çµ‚æ¡ç´æ¸…å–®
åˆ—å‡ºä½ èªç‚ºæ‡‰è©²æ¡ç´çš„æ‰€æœ‰æ”¹é€²ï¼ˆåŒ…æ‹¬ä½ è‡ªå·±çš„å’Œå…¶ä»–äººçš„ï¼‰ã€‚
é€™å€‹æ¸…å–®æœƒç”¨æ–¼å¤šæ•¸æ±ºæŠ•ç¥¨ã€‚
```

### Consensus Calculationï¼ˆç¨‹å¼è¨ˆç®—ï¼Œé AIï¼‰

```python
def calculate_consensus(adoption_lists: List[List[str]], threshold: float = 0.67):
    """
    æ ¹æ“š N å€‹å°ˆå®¶çš„æ¡ç´æ¸…å–®ï¼Œè¨ˆç®—æœ€çµ‚å…±è­˜
    
    threshold=0.67 è¡¨ç¤º 2/3 åŒæ„å³æ¡ç´
    N=3 æ™‚ï¼Œéœ€è¦ 2 ç¥¨
    N=5 æ™‚ï¼Œéœ€è¦ 4 ç¥¨ï¼ˆceil(5 * 0.67) = 4ï¼‰
    """
    all_suggestions = set()
    for lst in adoption_lists:
        all_suggestions.update(lst)
    
    adopted = []
    for suggestion_id in all_suggestions:
        votes = sum(1 for lst in adoption_lists if suggestion_id in lst)
        if votes / len(adoption_lists) >= threshold:
            adopted.append(suggestion_id)
    
    return adopted
```

### ç‚ºä»€éº¼ä¸éœ€è¦ Integratorï¼Ÿ

åœ¨ 2 è¼ªå…¨é¢è¨è«–æ¨¡å¼ä¸‹ï¼š
- å…±è­˜ç”±ç¨‹å¼è¨ˆç®—ï¼ˆå¤šæ•¸æ±ºï¼‰
- Writer ç›´æ¥æ”¶åˆ°æ¡ç´æ¸…å–®
- æ¸›å°‘ä¸€æ¬¡ AI å‘¼å«

---

## Writer Role (V4)

### V3 vs V4 çš„ Writer

| V3 Writer | V4 Writer |
|-----------|-----------|
| å¾ Structure Spec ç”Ÿæˆ Markmap | æ ¹æ“šæ¡ç´æ¸…å–®ä¿®æ”¹ç¾æœ‰ Markmap |
| éœ€è¦ç†è§£ YAML schema | éœ€è¦ç†è§£è‡ªç„¶èªè¨€å»ºè­° |
| å®Œæ•´ç”Ÿæˆ | ç²¾ç¢ºä¿®æ”¹ |

### V4 Writer çš„ä»»å‹™

1. **è¼‰å…¥ Baseline Markmap**
2. **ç†è§£æ¡ç´çš„æ”¹é€²æ¸…å–®**
3. **å®šä½ä¿®æ”¹ä½ç½®**
4. **åŸ·è¡Œä¿®æ”¹**
5. **é©—è­‰ä¿®æ”¹æ­£ç¢º**
6. **è¼¸å‡ºæ–°ç‰ˆæœ¬**

### Writer Prompt é‡é»

```markdown
ä½ æ˜¯ Markmap Writerã€‚ä½ çš„ä»»å‹™æ˜¯æ ¹æ“šå°ˆå®¶å…±è­˜çš„æ”¹é€²æ¸…å–®ï¼Œå°ç¾æœ‰çš„ Markmap é€²è¡Œç²¾ç¢ºä¿®æ”¹ã€‚

## é‡è¦åŸå‰‡

1. **æœ€å°åŒ–æ”¹å‹•** - åªåŸ·è¡Œæ¡ç´æ¸…å–®ä¸­çš„æ”¹é€²ï¼Œä¿ç•™å…¶ä»–æ‰€æœ‰å…§å®¹
2. **ä¿æŒé¢¨æ ¼ä¸€è‡´** - æ–°å¢å…§å®¹çš„æ ¼å¼è¦å’Œç¾æœ‰å…§å®¹ä¸€è‡´
3. **é©—è­‰é€£çµ** - å¦‚æœæ¶‰åŠé€£çµï¼Œç¢ºä¿ URL æ­£ç¢º
4. **ä¸è¦è‡ªä½œä¸»å¼µ** - åªåŸ·è¡Œæ¸…å–®ä¸­çš„æ”¹é€²ï¼Œä¸è¦è‡ªå·±å¢åŠ é¡å¤–ã€Œæ”¹é€²ã€

## è¼¸å…¥

### ç¾æœ‰ Markmap
{baseline_markmap}

### å°ˆå®¶å…±è­˜æ¡ç´çš„æ”¹é€²æ¸…å–®
{adopted_improvements}

ä»¥ä¸‹æ˜¯æ¯é …æ”¹é€²çš„è©³ç´°èªªæ˜ï¼ˆä¾†è‡ªå°ˆå®¶è¨è«–ï¼‰ï¼š
{improvement_details}

### åƒè€ƒè³‡æ–™ï¼ˆç”¨æ–¼é©—è­‰é€£çµç­‰ï¼‰
{reference_data}

## è¼¸å‡º

è¼¸å‡ºå®Œæ•´çš„ã€ä¿®æ”¹å¾Œçš„ Markmapã€‚
```

---

## Configuration (V4)

```yaml
# =============================================================================
# AI Markmap Agent Configuration V4
# =============================================================================

# -----------------------------------------------------------------------------
# Input Configuration
# -----------------------------------------------------------------------------
input:
  # Baseline Markmap to refine
  baseline:
    path: "neetcode_ontology_ai_en.md"
    # Where to find the baseline (relative to docs/mindmaps/)
  
  # Reference data for validation
  reference_data:
    ontology: true
    problems: true
    patterns: true

# -----------------------------------------------------------------------------
# Output Configuration  
# -----------------------------------------------------------------------------
output:
  # Output filename
  naming:
    template: "neetcode_ontology_agent_evolved_{lang}"
    # Produces: neetcode_ontology_agent_evolved_en.md
  
  # Version history
  versioning:
    enabled: true
    directory: "outputs/versions"
    
    # Execution mode:
    #   continue - Load from latest version (vN), produce vN+1
    #   reset    - Delete all versions, start from baseline.path, produce v1
    mode: "continue"
    
    # When mode=reset, prompt before deleting
    prompt_on_reset: true

# -----------------------------------------------------------------------------
# Expert Configuration (Scalable)
# -----------------------------------------------------------------------------
# åˆå§‹å¯¦ä½œï¼š3 å°ˆå®¶
# æ“´å±•æ™‚ï¼šåªéœ€åœ¨ enabled åˆ—è¡¨ä¸­å¢åŠ å°ˆå®¶ ID

experts:
  # å•Ÿç”¨çš„å°ˆå®¶ï¼ˆåˆå§‹å¯¦ä½œï¼‰
  enabled:
    - "architect"
    - "professor"
    - "engineer"
  
  # å°ˆå®¶å®šç¾©
  definitions:
    architect:
      name: "Top Software Architect"
      model: "gpt-4o"
      persona_prompt: "prompts/experts/architect_persona.md"
      behavior_prompt: "prompts/experts/architect_behavior.md"
      focus: "api_kernel_design"
    
    professor:
      name: "Distinguished Algorithm Professor"
      model: "gpt-4o"
      persona_prompt: "prompts/experts/professor_persona.md"
      behavior_prompt: "prompts/experts/professor_behavior.md"
      focus: "correctness_pedagogy"
    
    engineer:
      name: "Senior Principal Engineer"
      model: "gpt-4o"
      persona_prompt: "prompts/experts/engineer_persona.md"
      behavior_prompt: "prompts/experts/engineer_behavior.md"
      focus: "practical_value"
    
    # === æœªä¾†å¯æ“´å±•çš„å°ˆå®¶ï¼ˆå–æ¶ˆè¨»è§£ä»¥å•Ÿç”¨ï¼‰===
    
    # learner:
    #   name: "Advanced Learner Representative"
    #   model: "gpt-4o"
    #   persona_prompt: "prompts/experts/learner_persona.md"
    #   behavior_prompt: "prompts/experts/learner_behavior.md"
    #   focus: "learning_experience"
    
    # competitive:
    #   name: "Competitive Programming Champion"
    #   model: "gpt-4o"
    #   persona_prompt: "prompts/experts/competitive_persona.md"
    #   behavior_prompt: "prompts/experts/competitive_behavior.md"
    #   focus: "optimization_tricks"

# -----------------------------------------------------------------------------
# Workflow Configuration
# -----------------------------------------------------------------------------
workflow:
  # è¨è«–è¼ªæ•¸ï¼ˆå›ºå®š 2 è¼ªï¼‰
  discussion_rounds: 2
  
  # ä¸¦è¡ŒåŸ·è¡Œ
  parallel_execution: true
  
  # å…±è­˜é–€æª»
  # N=3: 0.67 â†’ éœ€è¦ 2/3 åŒæ„
  # N=5: 0.60 â†’ éœ€è¦ 3/5 åŒæ„
  consensus_threshold: 0.67

# -----------------------------------------------------------------------------
# Writer Configuration
# -----------------------------------------------------------------------------
writer:
  model: "gpt-4o"  # 128K context for full markmap
  behavior_prompt: "prompts/writer/writer_behavior.md"
  
  # Validation settings
  validate_links: true
  validate_format: true

# -----------------------------------------------------------------------------
# Post-Processing Configuration
# -----------------------------------------------------------------------------
post_processing:
  # Link validation (code-based)
  link_validator:
    enabled: true
    fix_broken_links: true
  
  # Text replacements (code-based)
  text_replacements:
    - pattern: "\\bLC[-\\s]?(\\d+)"
      replacement: "LeetCode \\1"
  
  # Translation
  translation:
    enabled: true
    languages:
      - target: "zh-TW"
        source: "en"
        model: "gpt-4o"
  
  # HTML generation
  html_generation:
    enabled: true
    template: "templates/markmap.html"
```

---

## Scalabilityï¼ˆæ“´å±•æ€§è¨­è¨ˆï¼‰

### å°ˆå®¶æ•¸é‡æ“´å±•

æ¶æ§‹æ”¯æ´å‹•æ…‹ N å°ˆå®¶ï¼ŒAPI å‘¼å«å…¬å¼ï¼š

```
Total API calls = 2N + 1
Sequential batches = 3ï¼ˆå›ºå®šï¼‰
```

| æ“´å±• | ä¿®æ”¹æ–¹å¼ |
|------|----------|
| å¢åŠ å°ˆå®¶ | åœ¨ `experts.enabled` å¢åŠ  ID |
| æ–°å°ˆå®¶é¡å‹ | åœ¨ `experts.definitions` æ–°å¢å®šç¾© |
| èª¿æ•´é–€æª» | ä¿®æ”¹ `consensus_threshold` |

### å¯æ“´å±•çš„å°ˆå®¶æ± 

```yaml
# æœªä¾†å¯ç”¨çš„å°ˆå®¶é¡å‹
future_experts:
  
  learner:
    description: "å­¸ç¿’è€…è¦–è§’ - é—œæ³¨å…¥é–€é›£åº¦ã€å¸¸è¦‹å›°æƒ‘"
    when_to_use: "é‡å°åˆå­¸è€…å„ªåŒ–æ™‚"
  
  competitive:
    description: "ç«¶è³½é¸æ‰‹è¦–è§’ - é—œæ³¨æ¥µé™å„ªåŒ–ã€å¿«é€Ÿè­˜åˆ¥"
    when_to_use: "ç«¶è³½å°å‘çš„ Markmap"
  
  interviewer:
    description: "é¢è©¦å®˜è¦–è§’ - é—œæ³¨è€ƒå¯Ÿé »ç‡ã€å€™é¸äººéŒ¯èª¤"
    when_to_use: "é¢è©¦æº–å‚™å°å‘"
  
  maintainer:
    description: "ç¶­è­·è€…è¦–è§’ - é—œæ³¨ä¸€è‡´æ€§ã€å¯æ›´æ–°æ€§"
    when_to_use: "é•·æœŸç¶­è­·çš„æ–‡æª”"
```

### å…±è­˜è¨ˆç®—çš„æ“´å±•æ€§

```python
def calculate_consensus(adoption_lists, threshold=None):
    """
    å‹•æ…‹å…±è­˜è¨ˆç®—ï¼Œæ”¯æ´ä»»æ„ N
    
    Auto thresholdï¼ˆå¦‚æœæœªæŒ‡å®šï¼‰:
        N=3 â†’ 0.67 (2/3)
        N=4 â†’ 0.75 (3/4)  
        N=5 â†’ 0.60 (3/5)
        N=6 â†’ 0.67 (4/6)
        N=7 â†’ 0.57 (4/7)
    """
    N = len(adoption_lists)
    
    if threshold is None:
        # è‡ªå‹•ï¼šéåŠä½†ä¸è¦å¤ªåš´æ ¼
        threshold = max(0.5, 1 - (1 / N))
    
    required_votes = ceil(N * threshold)
    # ... è¨ˆç®—é‚è¼¯
```

---

## File Structure (V4)

```
prompts/
â”œâ”€â”€ experts/                        # NEW (was strategists/)
â”‚   â”œâ”€â”€ architect_persona.md
â”‚   â”œâ”€â”€ architect_behavior.md
â”‚   â”œâ”€â”€ professor_persona.md
â”‚   â”œâ”€â”€ professor_behavior.md
â”‚   â”œâ”€â”€ engineer_persona.md
â”‚   â””â”€â”€ engineer_behavior.md
â”‚   # æœªä¾†æ“´å±•ï¼š
â”‚   # â”œâ”€â”€ learner_persona.md
â”‚   # â”œâ”€â”€ learner_behavior.md
â”‚   # â””â”€â”€ ...
â””â”€â”€ writer/
    â””â”€â”€ writer_behavior.md          # UPDATED for V4 (refinement mode)
```

**æ³¨æ„ï¼šV4 ç§»é™¤äº† `integrator/` ç›®éŒ„ï¼Œå…±è­˜ç”±ç¨‹å¼è¨ˆç®—ã€‚**

---

## Comparison: V3 vs V4

| é …ç›® | V3 | V4 |
|------|----|----|
| **èµ·é»** | ç©ºç™½ + è³‡æ–™ | å·²æœ‰é«˜å“è³ª Markmap |
| **Planner** | éœ€è¦ | âŒ ä¸éœ€è¦ |
| **ä¸­é–“æ ¼å¼** | Structure Spec (YAML) | ç›´æ¥æ“ä½œ Markmap |
| **å»ºè­°æ ¼å¼** | çµæ§‹åŒ– YAML | è‡ªç„¶èªè¨€ |
| **è¨è«–è¼ªæ•¸** | 3 è¼ª | 2 è¼ªï¼ˆå…¨é¢è¨è«–ï¼‰ |
| **Integrator** | AI æ•´åˆ | âŒ ç¨‹å¼è¨ˆç®—å…±è­˜ |
| **Strategist è§’è‰²** | æ³›åŒ– (UX, Architect...) | é ˜åŸŸå°ˆç²¾ |
| **Writer ä»»å‹™** | å¾ Spec ç”Ÿæˆ | æ ¹æ“šæ¡ç´æ¸…å–®ä¿®æ”¹ |
| **API å‘¼å«ï¼ˆN=3ï¼‰** | ~11 | 7 |
| **è¼¸å‡ºå“è³ª** | å®¹æ˜“å¹³åº¸ | ä¿ç•™åŸºåº•çš„å„ªç§€ + ç²¾é€² |

---

## Migration from V3

### ä¿ç•™çš„çµ„ä»¶
- Multi-round discussion logicï¼ˆç°¡åŒ–ç‚º 2 è¼ªï¼‰
- Consensus mechanismï¼ˆæ”¹ç‚ºç¨‹å¼è¨ˆç®—ï¼‰
- Writerï¼ˆwith updated promptï¼‰
- Post-processing pipeline

### ç§»é™¤çš„çµ„ä»¶
- Structure Planner (generalist/specialist)
- Structure Specification schema
- All planner prompts
- **Integrator**ï¼ˆå…±è­˜ç”±ç¨‹å¼è¨ˆç®—ï¼‰

### æ–°å¢çš„çµ„ä»¶
- Baseline loader
- Expert prompts (architect, professor, engineer)
- Refinement-mode writer prompt
- Consensus calculator (code)

### ç¨‹å¼ç¢¼è®Šæ›´

1. **graph.py** - ç§»é™¤ planner/integrator nodesï¼Œæ–°å¢ baseline loading
2. **state.py** - æ–°å¢ `baseline_markmap`, `expert_suggestions`, `adoption_lists` fields
3. **agents/experts.py** - æ–°å¢ Expert agent classes
4. **agents/writer.py** - æ›´æ–°ç‚º refinement mode
5. **consensus.py** - æ–°å¢å…±è­˜è¨ˆç®—é‚è¼¯ï¼ˆç¨‹å¼ï¼Œé AIï¼‰

---

## Example Run

```
$ python main.py --baseline neetcode_ontology_ai_en.md

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         AI Markmap Agent V4                               â•‘
â•‘                     Refinement Mode â€” 2 è¼ªå…¨é¢è¨è«–                         â•‘
â•‘                                                                           â•‘
â•‘  API Calls: 2N + 1 = 7 (N=3 experts)                                      â•‘
â•‘  Sequential Batches: 3                                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Loading baseline: neetcode_ontology_ai_en.md
  âœ“ Loaded (236 lines)

Loading reference data...
  âœ“ Ontology: 20 API kernels, 59 patterns
  âœ“ Problems: 33 problems
  âœ“ Patterns: 2 pattern docs

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Phase 1: Independent Review (3 parallel API calls)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  ğŸ—ï¸ Architect reviewing... âœ“ 4 suggestions
  ğŸ“š Professor reviewing... âœ“ 3 suggestions
  âš™ï¸ Engineer reviewing...  âœ“ 5 suggestions

  Total: 12 suggestions collected

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Phase 2: Full Discussion (3 parallel API calls)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Each expert reviewing all 12 suggestions...

  ğŸ—ï¸ Architect: Final adoption list [A1, A3, P1, P2, E1, E2, E4]
  ğŸ“š Professor: Final adoption list [A1, A2, P1, P3, E1, E3]
  âš™ï¸ Engineer:  Final adoption list [A1, A2, A3, P1, E1, E2, E4, E5]

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Consensus Calculation (Code, not AI)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Threshold: 2/3 (0.67)
  
  A1: 3/3 âœ… â†’ Adopted
  A2: 2/3 âœ… â†’ Adopted
  A3: 2/3 âœ… â†’ Adopted
  P1: 3/3 âœ… â†’ Adopted
  P2: 1/3 âŒ â†’ Rejected
  P3: 1/3 âŒ â†’ Rejected
  E1: 3/3 âœ… â†’ Adopted
  E2: 2/3 âœ… â†’ Adopted
  E3: 1/3 âŒ â†’ Rejected
  E4: 2/3 âœ… â†’ Adopted
  E5: 1/3 âŒ â†’ Rejected

  âœ… Adopted: 7 improvements
  âŒ Rejected: 5 suggestions

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Phase 3: Writing (1 API call)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Applying 7 improvements to baseline...
  âœ“ Output: neetcode_ontology_agent_evolved_en.md

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Phase 4: Post-Processing (Code)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  âœ“ Link validation: 47/47 valid
  âœ“ Format fixing: 2 replacements
  âœ“ Translation: neetcode_ontology_agent_evolved_zh-TW.md (1 API call)
  âœ“ HTML generation: 2 files

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Complete!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Summary:
  - API calls: 7 (+ 1 for translation = 8)
  - Time: ~45 seconds (3 sequential batches)
  - Improvements applied: 7

Output files:
  docs/mindmaps/neetcode_ontology_agent_evolved_en.md
  docs/mindmaps/neetcode_ontology_agent_evolved_zh-TW.md
  docs/pages/mindmaps/neetcode_ontology_agent_evolved_en.html
  docs/pages/mindmaps/neetcode_ontology_agent_evolved_zh-TW.html

Version history:
  outputs/versions/v1/neetcode_ontology_agent_evolved_en.md
  outputs/versions/v1/neetcode_ontology_agent_evolved_zh-TW.md
```

---

## Versioning Modes

### Continue Mode (é è¨­)

æŒçºŒç²¾é€²ï¼Œå¾æœ€æ–°ç‰ˆæœ¬ç¹¼çºŒï¼š

```yaml
versioning:
  mode: "continue"
```

```
ç¾æœ‰ç‰ˆæœ¬: v1, v2, v3

åŸ·è¡Œæµç¨‹:
1. è®€å– v3 çš„è¼¸å‡ºä½œç‚º baseline
2. å°ˆå®¶ç²¾é€²
3. ç”¢ç”Ÿ v4
```

### Reset Mode

é‡æ–°é–‹å§‹ï¼Œå¾åŸå§‹ baseline å‡ºç™¼ï¼š

```yaml
versioning:
  mode: "reset"
```

```
ç¾æœ‰ç‰ˆæœ¬: v1, v2, v3

åŸ·è¡Œæµç¨‹:
1. ç¨‹å¼è©¢å•ï¼šã€Œç¢ºå®šè¦åˆªé™¤ v1, v2, v3 å—ï¼Ÿ[Y/N]ã€
2. Y â†’ åˆªé™¤æ‰€æœ‰ç‰ˆæœ¬ï¼Œå¾ input.baseline.path é‡æ–°é–‹å§‹
3. N â†’ ç¨‹å¼çµæŸï¼Œä¸åšä»»ä½•äº‹
4. ç”¢ç”Ÿæ–°çš„ v1
```

### ä½¿ç”¨å ´æ™¯

| å ´æ™¯ | ä½¿ç”¨æ¨¡å¼ |
|------|---------|
| æ—¥å¸¸è¿­ä»£ç²¾é€² | `continue` |
| åˆ‡æ›æ–°çš„ baseline ä¾†æº | `reset` |
| ç‰ˆæœ¬æ­·å²å¤ªäº‚æƒ³é‡ä¾† | `reset` |
| æ¸¬è©¦æ–°çš„å°ˆå®¶é…ç½® | `reset` |

---

## Summary

### V4 æ ¸å¿ƒè¨­è¨ˆ

1. **ç²¾é€²æ¨¡å¼** - å¾å·²æœ‰çš„é«˜å“è³ª Markmap å‡ºç™¼
2. **2 è¼ªå…¨é¢è¨è«–** - Round 1 ç¨ç«‹å¯©æŸ¥ + Round 2 å…¨é¢è¨è«–
3. **ç¨‹å¼è¨ˆç®—å…±è­˜** - å¤šæ•¸æ±ºï¼ˆ2/3ï¼‰ï¼Œä¸ç”¨ AI Integrator
4. **è‡ªç„¶èªè¨€å»ºè­°** - ç™¼æ® AI æœ€å¼·çš„èªè¨€ç†è§£èƒ½åŠ›
5. **å¯æ“´å±•** - æ”¯æ´å‹•æ…‹ N å°ˆå®¶ï¼ŒAPI å‘¼å« = 2N + 1

### API å‘¼å«æ•ˆç‡

| é…ç½® | API å‘¼å« | Sequential Batches |
|------|---------|-------------------|
| 3 å°ˆå®¶ï¼ˆåˆå§‹ï¼‰ | 7 | 3 |
| 5 å°ˆå®¶ï¼ˆæ“´å±•ï¼‰ | 11 | 3 |
| 7 å°ˆå®¶ï¼ˆå®Œæ•´ï¼‰ | 15 | 3 |

### é—œéµå„ªå‹¢

- **Sequential batches å›ºå®šç‚º 3** - ä¸ç®¡å¹¾å€‹å°ˆå®¶ï¼Œç­‰å¾…æ™‚é–“ä¸€æ¨£
- **ä¸éœ€è¦ Integrator** - æ¸›å°‘ 1 æ¬¡ AI å‘¼å«
- **ä¿ç•™åŸºåº•å„ªé»** - ä¸æœƒå› ç‚ºå§”å“¡æœƒæ•ˆæ‡‰è€Œè®Šå¹³åº¸

---

## Appendix A: Expert Prompt Templates

è¦‹ `prompts/experts/` ç›®éŒ„

## Appendix B: Writer Prompt Template (Refinement Mode)

è¦‹ `prompts/writer/writer_behavior.md`

## Appendix C: Consensus Calculation Logic

è¦‹ `src/consensus.py`ï¼ˆç¨‹å¼ç¢¼ï¼Œé promptï¼‰

